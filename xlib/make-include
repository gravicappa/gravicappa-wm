#!/usr/bin/gsi-script -:d-

(define (process-toplevel form)
  (case (car form)
    ((define %define/x-setter %define/x-const %define/x-pstruct-getter) 
      (let ((name (if (pair? (cadr form)) (caadr form) (cadr form))))
        (if (not (char=? #\% (string-ref (symbol->string name) 0)))
            (begin
              (newline)
              (display "    ")
              (display name)))))))

(define (read-data)
  (let loop ((acc '()))
    (let ((form (read)))
      (if (not (eof-object? form))
          (loop (cons form acc))
          (reverse acc)))))

(display "(##namespace")
(newline)
(display "  (\"")
(if (pair? (cdr (command-line)))
		(display (cadr (command-line))))
(display "#\"")
(map (lambda (top)
			 (if (pair? top)
					 (process-toplevel top)))
		 (read-data))
(display "))")
(newline)
